<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <meta name="description" content="">
        <meta name="author" content="TemplateMo">

        <title>Budget PopAtelier</title>

        <!-- CSS FILES -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        
        <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">

        <link href="./css/bootstrap.min.css" rel="stylesheet">

        <link href="./css/bootstrap-icons.css" rel="stylesheet">

        <link href="./css/magnific-popup.css" rel="stylesheet">

        <!--Main styles-->
        <link href="./css/templatemo-first-portfolio-style.css" rel="stylesheet">
        <link rel="stylesheet" href="./css/index.css">

        <link rel="shortcut icon" href="./images/popnav.png" type="image/x-icon">
    </head>
    
    <body>

        <section class="preloader">
            <div class="spinner">
                <span class="spinner-rotate"></span>    
            </div>
        </section>

        <nav class="navbar navbar-expand-lg">
            <div class="container">
                <h1 class="headertext">Smart <span style="margin-left: 5px;">Display</span> <span style="margin-left: 5px;">Quotations</span></h1>
                <a href="https://www.popatelier.net/" class="navbar-brand mx-auto mx-lg-0" target="_blank"><img src="./images/pop.png" alt="Logo" class="logo"></a>
            </div>
        </nav>        
    

        <br><br> <br><br> <br><br><br><br>

        <header>
            <h1>Quoations&nbsp;<i class="bi bi-archive-fill"></i></h1>
        </header>
        <i class="tooltip bi bi-question"></i> <small style="font-size: 10px;" class="tooltiptext">
            <i class="bi bi-question-circle-fill"></i> Experience the capabilities of our Budget Smart system through interactive panels, enabling you to simulate estimated costs associated with product placement to craft your personalized stand.
        </small>
        
       
        

        <form action="#" method="POST">
            <div class="main-wrapper">
                <main>
                    <div class="container-fluid">
                        
                        <div class="row">
                            <div class="col-12">
                               <button type="button" id="addHeaderBtn" class="btn btn-primary mr-2">Add Header</button>
                                <!-- <button type="button" id="deleteHeaderBtn" class="btn btn-danger"><i class="bi bi-trash"></i></button> -->
                            </div>
                        </div>

                        <br>
                        <div class="row">
                            
                        </div>
                        <div class="headers-container">
                            <!-- Aquí se agregarán dinámicamente los campos de entrada -->
                        </div>
                        <br>
                    </div>
                </main>
            </div>

            <div class="main-wrapper">
                <main>
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-12">
                                <button type="button" id="addShielfBtn" class="btn btn-primary mr-2">Add Shelf</button>
                                <!-- <button type="button" id="deleteShielfBtn" class="btn btn-danger"><i class="bi bi-trash"></i></button> -->
                            </div>
                        </div>

                        <br>
                        <div class="row">
                            
                        </div>
                        <div class="shielfs-container">
                            <!-- Aquí se agregarán dinámicamente los campos de entrada -->
                        </div>
                        <br>
                        <button type="button" id="addToListBtn" class="btn btn-success">Add to list</button>

                    </div>
                </main>
            </div>

            <header>
                <h1>Preview List &nbsp;<i class="bi bi-cart-check-fill"></i></h1>
            </header>
           
            <div id="dataDisplay">Lotes</div>
            <div id="totalPriceDisplay"></div>
            <br><br>
            <header>
                <h1>Data client&nbsp;<i class="bi bi-people-fill"></i></h1>
            </header>
           
            <main>
               
                <div class="container-fluid">
                    <div class="row">
                    
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                            <label class="bmd-label-floating">Name Company: </label>
                            <input type="text" class="form-control" name="name_company" id="" required>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                            <label class="bmd-label-floating">Address Company: </label>
                            <input type="text" class="form-control" name="address_company" id="" required>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                            <label class="bmd-label-floating">Phone: </label>
                            <input type="text" class="form-control" name="phone_company" id="" required>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                            <label class="bmd-label-floating">Business Email: </label>
                            <input type="text" class="form-control" name="business_email_company" id="" required>
                            </div>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                            <label class="bmd-label-floating">Name Client: </label>
                            <input type="text" class="form-control" name="name_client" id="" required>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                            <label class="bmd-label-floating">Address client: </label>
                            <input type="text" class="form-control" name="address_client" id="" required>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                            <label class="bmd-label-floating">Phone: </label>
                            <input type="text" class="form-control" name="phone_client" id="" required>
                            </div>
                        </div>
                        <div class="col-12 col-md-6">
                            <div class="form-group">
                            <label class="bmd-label-floating">Business Email Client: </label>
                            <input type="text" class="form-control" name="email_client" id="" required>
                            </div>
                        </div>
                        
                    </div>
                    <br>
                    <button class="btn btn-generar-pdf btn-success" type="submit" id="btn-generar">Generate PDF</button>
                    <br>
                </div>
            </main>

        </form>


        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="./js/generate-hs.js"></script>
        <script>
        var currentBatch = 1; // Inicializar el contador de lotes
        var preciosPorSeleccion = {
            'P2 120 Header': 1392.391,
            'P1.8 120 Header': 2086.5,
            'P1.5 120 Header': 2386.8,
            'P1.2 120 Header': 3110.276,

            'P2 90 Header': 1189.864,
            'P1.8 90 Header': 1431.3,
            'P1.5 90 Header': 1627.47,
            'P1.2 90 Header': 2386.956,

            'P2 60 Header': 848.9,
            'P1.8 60 Header': 1171.3,
            'P1.5 60 Header': 1232.4,
            'P1.2 60 Header': 1656.2,

            'P2 45 Header': 848.9,
            'P1.8 45 Header': 1171.3,
            'P1.5 45 Header': 1232.4,
            'P1.2 45 Header': 1656.2,

            'P1.8 120 Shelf': 640.9,
            'P1.57 120 Shelf': 672.1,
            'P1.2 120 Shelf': 861.9,

            'P1.8 90 Shelf': 456.3,
            'P1.57 90 Shelf': 533,
            'P1.2 90 Shelf': 655.2,

            'P1.8 60 Shelf': 362.7,
            'P1.57 60 Shelf': 440.7,
            'P1.2 60 Shelf': 487.5,

            'P1.8 45 Shelf': 555.1,
            'P1.57 45 Shelf': 617.5,
            'P1.2 45 Shelf': 679.9
        };

        //Prices
        var video_procesor = 377.988;
        var freight_import_taxes = 487.20;
        var install = 931.02;
        var cms = 152.1;
        var noc = 720;
        var totalFixed;

        // Calcular la suma de los precios
        totalFixed = video_procesor + freight_import_taxes + install + cms + noc;

        function calcularDescuentoPorLotes(cantidadLotes) {
                if (cantidadLotes >= 150 && cantidadLotes <= 500) {
                    return 0.00; // Sin descuento
                } else if (cantidadLotes >= 501 && cantidadLotes <= 1000) {
                    return 0.02; // Descuento del 2%
                } else if (cantidadLotes >= 1001 && cantidadLotes <= 2000) {
                    return 0.035; // Descuento del 3.5%
                } else if (cantidadLotes >= 2001 && cantidadLotes <= 3000) {
                    return 0.05; // Descuento del 5%
                } else if (cantidadLotes > 3000) {
                    return 0.075; // Descuento del 7.5%
                } else {
                    return 0; // Sin descuento
                }
        }

        
        </script>


        <script>
           $(document).ready(function() {
            function saveDataToStorage(data, batch) {
                localStorage.setItem('itemsData' + batch, JSON.stringify(data));
            }

            function updateDataDisplay() {
                var dataDisplay = $('#dataDisplay');
                dataDisplay.empty(); // Limpiar el contenido actual
                var totalPriceDisplay = $('#totalPriceDisplay'); // Obtener el div para mostrar el precio total
                totalPriceDisplay.empty();

                var totalAllBatchesPrice = 0; // Inicializar el precio total de todos los lotes
                var cantidadLotes = 0; // Inicializar la cantidad de lotes

                for (var i = 1; i < currentBatch; i++) {
                    var storedData = JSON.parse(localStorage.getItem('itemsData' + i));
                    cantidadLotes++;

                    if (storedData !== null) { // Verificar si storedData no es nulo
                        var totalPricePerBatch = 0; // Inicializar el precio total del lote actual

                        var table = $('<table class="batch-table"></table>');

                        // Calcular el precio total del lote actual
                        storedData.forEach(function(item) {
                            var itemKey = item.size;
                            if (preciosPorSeleccion.hasOwnProperty(itemKey)) {
                                var pricePerItem = preciosPorSeleccion[itemKey];
                                var totalForItem = pricePerItem * item.quantity;
                                totalPricePerBatch += totalForItem;
                            }
                        });

                        // Agregar el total fijo al precio total del lote actual
                        totalPricePerBatch += totalFixed;

                        // Actualizar el total de todos los lotes sumados
                        totalAllBatchesPrice += totalPricePerBatch;

                        // Crear fila para mostrar el precio total del lote
                        var totalRow = $('<tr><td colspan="4"><strong>Price KIT(Including prices for requeriments) ' + i + ': $ ' + totalPricePerBatch + '</strong></td></tr>');
                        table.append(totalRow);


                        // Crear la cabecera de la tabla
                        var thead = $('<thead><tr><th colspan="8">KIT ' + i + '</th><th><button class="btn delete-batch-btn btn-danger" data-batch="' + i + '"><i class="bi bi-trash"></i></button></th></tr></thead>');
                        table.append(thead);

                        var tbody = $('<tbody></tbody>');

                        // Crear filas para cada elemento en el lote
                        storedData.forEach(function(item) {
                            var row = $('<tr></tr>');
                            for (var key in item) {
                                console.log(item)
                                if (item.hasOwnProperty(key)) {
                                    row.append('<td><strong>' + key + '</strong></td>');
                                    row.append('<td>' + item[key] + '</td>');
                                }
                            }

                            // Agregar columna para el precio total por tipo y tamaño
                            var itemKey = item.size;
                            console.log(itemKey)
                            if (preciosPorSeleccion.hasOwnProperty(itemKey)) {
                                var pricePerItem = preciosPorSeleccion[itemKey];
                                var totalForItem = pricePerItem * item.quantity;
                                row.append('<td>Price per item: ' + pricePerItem + '</td>');
                                row.append('<td>Total price: ' + totalForItem + '</td>');
                            }

                            tbody.append(row);
                        });

                        table.append(tbody);
                        dataDisplay.append(table);
                    }
                }

                // Calcular el descuento basado en la cantidad de lotes
                var descuentoPorLotes = calcularDescuentoPorLotes(cantidadLotes);
                var descuentoTotal = totalAllBatchesPrice * descuentoPorLotes;
                var precioFinal = totalAllBatchesPrice - descuentoTotal;

                // Mostrar el descuento aplicado
                var descuentoRow = $('<div>Discount applied: $ ' + descuentoTotal.toFixed(2) + '</div>');
                descuentoRow.css({
                    'font-weight': 'bold',
                    'font-size': '1.2em',
                    'color': 'red' // Puedes cambiar el color según tu preferencia
                });

                totalPriceDisplay.append(descuentoRow);

                // Mostrar el precio final después de aplicar el descuento
                var precioFinalRow = $('<div>Final price after discount: $ ' + precioFinal.toFixed(2) + '</div>');
                precioFinalRow.css({
                    'font-weight': 'bold',
                    'font-size': '1.2em',
                    'color': 'black' // Puedes cambiar el color según tu preferencia
                });

                totalPriceDisplay.append(precioFinalRow);

            }



            // Función para eliminar un lote al hacer clic en el botón "Delete Batch"
            $(document).on('click', '.delete-batch-btn', function() {
                var batchNumber = $(this).data('batch');
                var confirmation = confirm('Are you sure delete this batch ' + batchNumber + '?');

                if (confirmation) {
                    localStorage.removeItem('itemsData' + batchNumber);
                    updateDataDisplay();
                }
            });


            $('#addToListBtn').click(function() {
                var headerItems = $('.headers-container .row');
                var shielfItems = $('.shielfs-container .row');

                // Imprimir el resultado en la consola
                console.log('El total por lote: ', totalFixed);

                var currentBatchItems = []; // Array para el lote actual
                var itemsByTypeAndSize = {};

                headerItems.each(function() {
                    var headerSize = $(this).find('select[name="headerSize"]').val();
                    var headerSizePi = $(this).find('select[name="headerSizePi"]').val();
                    var quantity = $(this).find('input[name="quantity"]').val();
                    var key = headerSizePi + ' ' + headerSize + ' ' + 'Header'; // Generar clave de tipo y tamaño

                    // Almacenar el artículo en la estructura de datos itemsByTypeAndSize
                    if (!itemsByTypeAndSize[key]) {
                        itemsByTypeAndSize[key] = {
                            type: 'Header',
                            size: key,
                            quantity: 0
                        };
                    }
                    itemsByTypeAndSize[key].quantity += parseInt(quantity); // Actualizar la cantidad

                    currentBatchItems.push({
                        type: 'Header',
                        size: key,
                        quantity: quantity
                    });
                });

                shielfItems.each(function() {
                    var shielfSize = $(this).find('select[name="shielfSize"]').val();
                    var piShielf = $(this).find('select[name="piShielf"]').val();
                    var quantity = $(this).find('input[name="quantity"]').val();
                    var key = piShielf + ' ' + shielfSize + ' ' + 'Shelf'; // Generar clave de tipo y tamaño

                    // Almacenar el artículo en la estructura de datos itemsByTypeAndSize
                    if (!itemsByTypeAndSize[key]) {
                        itemsByTypeAndSize[key] = {
                            type: 'Shelf',
                            size: key,
                            quantity: 0
                        };
                    }
                    itemsByTypeAndSize[key].quantity += parseInt(quantity); // Actualizar la cantidad

                    currentBatchItems.push({
                        type: 'Shelf',
                        size: key,
                        quantity: quantity
                    });
                });


                // Guardar el lote actual en localStorage con una clave diferente para cada lote
                localStorage.setItem('itemsData' + currentBatch, JSON.stringify(currentBatchItems));
                console.log('Lote ' + currentBatch + ': ', currentBatchItems);

                currentBatch++; // Incrementar el contador para el próximo lote
                updateDataDisplay(); // Actualizar la visualización de los datos


                var headerItems = $('.headers-container .row');
                var shielfItems = $('.shielfs-container .row');

                // Restablecer los campos de entrada en headers-container y shielfs-container
                $('.headers-container').empty();
                $('.shielfs-container').empty();

                // Calcular el precio total por lote
                var totalPricePerLote = totalFixed;
                currentBatchItems.forEach(function(item) {
                    var key = item.size;
                    if (preciosPorSeleccion.hasOwnProperty(key)) {
                        totalPricePerLote += preciosPorSeleccion[key] * item.quantity;
                    }
                });

                console.log('El precio total por lote es: ' + totalPricePerLote);

                // Mostrar el desglose de precios por tipo y tamaño
                for (var itemKey in itemsByTypeAndSize) {
                    var item = itemsByTypeAndSize[itemKey];
                    var key = item.size;
                    if (preciosPorSeleccion.hasOwnProperty(key)) {
                        var pricePerItem = preciosPorSeleccion[key];
                        var totalForItem = pricePerItem * item.quantity;
                        console.log('Tipo y tamaño:', item.size, ' Cantidad:', item.quantity, ' Precio por artículo:', pricePerItem, ' Precio total:', totalForItem);
                    }
                }
            });

            // Mostrar los datos al cargar la página
            updateDataDisplay();
        });
        </script>

    <script>




    </script>




        <!-- JAVASCRIPT FILES -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.4/jspdf.debug.js"></script>
        <script src="./js/jquery.min.js"></script>
        <script src="./js/bootstrap.min.js"></script>
        <script src="./js/jquery.sticky.js"></script>
        <script src="./js/click-scroll.js"></script>
        <script src="./js/jquery.magnific-popup.min.js"></script>
        <script src="./js/magnific-popup-options.js"></script>
        <script src="./js/custom.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="./js/generate-pdf.js"></script>

    </body>
</html>